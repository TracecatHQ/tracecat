type: action
definition:
  title: Deep research
  description: Deep research on a given topic.
  display_group: Exa
  doc_url: https://docs.exa.ai/reference/research/create-a-task
  namespace: tools.exa
  name: deep_research
  secrets:
    - name: exa
      keys: ["EXA_API_KEY"]
  expects:
    instructions:
      type: str
      description: Instructions for what you would like research on.
  steps:
    - ref: create_research
      action: core.http_request
      args:
        url: https://api.exa.ai/research/v1/research/v1
        method: POST
        headers:
          Content-Type: application/json
          x-api-key: ${{ SECRETS.exa.EXA_API_KEY }}
        payload:
          model: exa-research
          instructions: ${{ inputs.instructions }}
    - ref: poll_research
      action: core.http_poll
      args:
        url: https://api.exa.ai/research/v1/research/v1/${{ steps.create_research.result.data.researchId }}
        method: GET
        headers:
          x-api-key: ${{ SECRETS.exa.EXA_API_KEY }}
        poll_condition: >
          lambda x: x['data'].get('status') == 'completed'
        poll_retry_codes:
          - 201
  returns: ${{ steps.poll_research.result.data }}
