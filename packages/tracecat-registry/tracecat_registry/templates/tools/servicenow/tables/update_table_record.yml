type: action
definition:
  title: Update table record
  description: Update a record in a ServiceNow table by sys_id.
  display_group: ServiceNow
  doc_url: https://developer.servicenow.com/dev.do#!/reference/api/u_tahoe/rest/c_TableAPI#r_TableAPI-PATCH
  namespace: tools.servicenow
  name: update_table_record
  secrets:
    - name: servicenow
      keys: ["SERVICENOW_USERNAME", "SERVICENOW_PASSWORD"]
expects:
  instance_url:
    type: str | None
    description: ServiceNow instance URL (e.g., https://your-instance.service-now.com)
    default: null
  table:
    type: str
    description: Target table name (e.g., incident, cmdb_ci_service).
  record_id:
    type: str
    description: Record sys_id.
  fields:
    type: dict[str, Any]
    description: Field values to update.
steps:
  - ref: update_record
    action: core.http_request
    args:
      method: PATCH
      url: ${{ (inputs.instance_url || VARS.servicenow.instance_url) }}/api/now/table/${{ FN.url_encode(inputs.table) }}/${{ FN.url_encode(inputs.record_id) }}
      auth:
        username: ${{ SECRETS.servicenow.SERVICENOW_USERNAME }}
        password: ${{ SECRETS.servicenow.SERVICENOW_PASSWORD }}
      headers:
        Accept: application/json
        Content-Type: application/json
      payload: ${{ inputs.fields }}
returns: ${{ steps.update_record.result.data }}
