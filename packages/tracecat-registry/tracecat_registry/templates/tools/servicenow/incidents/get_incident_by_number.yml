type: action
definition:
  title: Get incident
  description: Fetch an incident by number.
  display_group: ServiceNow
  doc_url: https://developer.servicenow.com/dev.do#!/reference/api/u_tahoe/rest/c_TableAPI#r_TableAPI-GET
  namespace: tools.servicenow
  name: get_incident_by_number
  secrets:
    - name: servicenow
      keys: ["SERVICENOW_USERNAME", "SERVICENOW_PASSWORD"]
expects:
  instance_url:
    type: str | None
    description: ServiceNow instance URL (e.g., https://your-instance.service-now.com)
    default: null
  incident_number:
    type: str
    description: Incident number (e.g., INC0010001).
steps:
  - ref: get_incident
    action: core.http_request
    args:
      method: GET
      url: ${{ (inputs.instance_url || VARS.servicenow.instance_url) }}/api/now/table/incident
      auth:
        username: ${{ SECRETS.servicenow.SERVICENOW_USERNAME }}
        password: ${{ SECRETS.servicenow.SERVICENOW_PASSWORD }}
      params:
        sysparm_query: number=${{ FN.url_encode(inputs.incident_number) }}
        sysparm_limit: 1
        sysparm_display_value: true
        sysparm_exclude_reference_link: true
returns: ${{ steps.get_incident.result.data }}
