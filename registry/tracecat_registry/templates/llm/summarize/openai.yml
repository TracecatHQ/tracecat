type: action
definition:
  title: Summarize
  description: Summarize a given text using OpenAI LLMs.
  display_group: Summarize
  doc_url: https://platform.openai.com/docs/guides/summarization
  namespace: openai.summarize
  name: summarize
  expects:
    input:
      type: str
      description: Text to summarize.
    input_context:
      type: str
      description: Description of the input text (e.g. "Job description").
    max_length:
      type: int
      description: Maximum number of characters in the summary.
  steps:
    - ref: summarize
      action: llm.openai.call
      args:
        prompt: |
          Summarize the following text:
          <input_data>
          ${{ inputs.input }}
          </input_data>
        instructions: |
          You are an expert summarizer of unstructured text, specifically knowledgeable about ${{ inputs.input_context }}.
          You will analyze this text from the perspective of a domain expert in ${{ inputs.input_context }}.

          <task>
          1. Identify the key topic and purpose of the text
          2. Extract the most important entities and relationships
          3. Finally, provide a concise summary that reflects domain-specific expertise
          </task>

          <requirements>
          - The summary should be no more than ${{ inputs.max_length }} characters.
          - The summary should be concise and to the point.
          - The summary should be written in the style of a domain expert in ${{ inputs.input_context }}.
          </requirements>
        text_format:
          type: json_schema
          name: summarize
          schema:
            type: object
            properties:
              context:
                type: string
                description: What is the main topic of the text in 1-sentence?
              purpose:
                type: string
                description: What is the purpose of the text in 1-sentence?
              key_points:
                type: array
                items:
                  type: string
                description: List of the most important entities and relationships.
              summary:
                type: string
                description: Summary of the text.
            required:
              - context
              - purpose
              - key_points
              - summary
            additionalProperties: false
          strict: true
    - ref: output
      action: core.transform.reshape
      args:
        value: ${{ FN.deserialize_json(steps.summarize.result.output_text) }}
  returns: ${{ FN.lookup(steps.output.result, "summary") }}
