type: action
definition:
  title: Ask text input
  description: Ask the user for a text input in a Slack channel.
  display_group: Slack
  doc_url: https://api.slack.com/methods/chat.postMessage
  namespace: tools.slack
  name: ask_text_input
  secrets:
    - name: slack
      keys: ["SLACK_BOT_TOKEN"]
  expects:
    prompt:
      type: str
      description: Prompt to ask the user. Supports Markdown.
    metadata:
      type: dict[str, any]
      # TODO: Add information about where to find `metadata` in the interaction payload
      description: Metadata to add to the interaction payload as `event_payload`.
    channel:
      type: str
      description: ID that represents a channel, private group, or IM channel.
    thread_ts:
      type: str | None
      description: Adds comment to a thread given the thread timestamp.
      default: null
  steps:
    - ref: text_input_block
      action: tools.slack_blocks.format_text_input
      args:
        prompt: ${{ inputs.prompt }}
        dispatch_action: true
    - ref: ask_input
      action: tools.slack_sdk.call_method
      args:
        sdk_method: chat_postMessage
        params:
          channel: ${{ inputs.channel }}
          text: ${{ inputs.prompt }}
          metadata:
            event_type: text_input
            event_payload: ${{ inputs.metadata }}
          thread_ts: ${{ inputs.thread_ts }}
          blocks:
            - ${{ steps.text_input_block.result }}
  returns: ${{ steps.ask_input.result.message }}
