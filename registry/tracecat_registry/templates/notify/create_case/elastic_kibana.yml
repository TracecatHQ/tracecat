type: action
definition:
  title: Create case
  description: Create a new case in Elastic Kibana.
  display_group: Elastic
  doc_url: https://www.elastic.co/docs/api/doc/kibana/v8/operation/operation-createcasedefaultspace
  namespace: tools.elastic
  name: create_case
  secrets:
    - name: elastic_kibana
      keys: ["ELASTIC_API_KEY"]
  expects:
    summary:
      type: str
      description: Brief one-line summary of the incident.
    description:
      type: str
      description: A detailed description of the incident.
    severity:
      type: enum["low", "medium", "high", "critical"]
      description: Severity of the incident.
    tags:
      type: list[str]
      description: Tags to categorize the incident.
      default: []
    custom_fields:
      type: list[dict[str, any]]
      description: Custom fields to add to the incident.
      default: []
    base_url:
      type: str
      description: Kibana endpoint URL (e.g. https://localhost:5601).
    app_owner:
      type: str
      description: Application that owns the cases (`cases`, `observability`, or `securitySolution`).
      default: cases
  steps:
    - ref: create_case
      action: core.http_request
      args:
        url: ${{ inputs.base_url }}/api/cases
        method: POST
        headers:
          kbn-xsrf: kibana
          Authorization: ApiKey ${{ SECRETS.elastic_kibana.ELASTIC_API_KEY }}
        payload:
          title: ${{ inputs.summary }}
          description: ${{ inputs.description }}
          severity: ${{ inputs.severity }}
          custom_fields: ${{ inputs.custom_fields }}
          tags: ${{ inputs.tags }}
          owner: ${{ inputs.app_owner }}
          # Assignees is a required field, but in Tracecat we suggest creating the case first
          # then assigning users to the case in a separate step.
          assignees: []
          category: null
          settings:
            syncAlerts: true
          connector:
            fields: null
            id: "none"
            name: "none"
            type: ".none"
  returns: ${{ steps.create_case.result }}
