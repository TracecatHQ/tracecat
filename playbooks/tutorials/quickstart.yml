definition:
  title: Enrich URL with VirusTotal
  description: Search for a URL in VirusTotal and list all community comments if malicious.
  config:
    environment: default
  entrypoint:
    expects: {}
    ref: search_url_with_virustotal
  inputs: {}
  returns: null
  triggers: []
  actions:
  - action: integrations.virustotal.search_url
    ref: search_url_with_virustotal
    args:
      url: ${{ TRIGGER.url }}
  - action: core.transform.reshape
    ref: extract_virustotal_report
    args:
      value:
        stats: ${{ ACTIONS.search_url_with_virustotal.result.data.data.attributes.last_analysis_stats }}
        url: ${{ ACTIONS.search_url_with_virustotal.result.data.data.attributes.url }}
    depends_on:
    - search_url_with_virustotal
  - action: integrations.virustotal.list_comments
    ref: list_virustotal_comments_on_url
    run_if: ${{ ACTIONS.extract_virustotal_report.result.stats.malicious > 10 }}
    args:
      url: ${{ ACTIONS.extract_virustotal_report.result.url }}
    depends_on:
    - extract_virustotal_report
