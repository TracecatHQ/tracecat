---
title: Control Flow
description: Learn how to use if-conditions and loops in your workflows.
---

## Goals

By the end of this tutorial, you will learn how to:

- Reference data from previous actions
- Use the **Reshape** action to organize data
- Use if-conditions to control the flow of your workflow
- Use loop iteration to iterate over a list of items from a previous action

## Prerequisites

- Completed the [Quickstart](/tutorials/quickstart) tutorial
- Basic knowledge of [JSONPath match syntax](https://www.ietf.org/archive/id/draft-ietf-jsonpath-base-01.html)

## Tutorial

<Steps>
    <Step title="Organize data using the Reshape action">
        The JSON object returned from the **Search URL with VirusTotal** action can be quite verbose, for example:

        ![VirusTotal search result](/img/tutorials/control-flow/vt-search-result.png)

        Let's use the **Reshape** action along with JSONPath match to extract then organize the data we need for other actions.

        ![Reshape action](/img/tutorials/control-flow/reshape-action.png)

        In the screenshot above, we renamed the action to `Extract VirusTotal report`, then configured the action with the following expression:

        ```yaml
        value:
            url: ${{ ACTIONS.search_url_with_virustotal.result.data.data.attributes.url }}
            stats: ${{ ACTIONS.search_url_with_virustotal.result.data.data.attributes.last_analysis_stats }}
        ```

        <Note>
            The `ACTIONS` expression namespace contains all the results from previous actions.
            To get the result from a previous action, you call `ACTIONS.<action key>.result`,
            where `<action key>` is the snake-cased name of the action.

            For example, the action key for an action named "Search URL with VirusTotal" is `search_url_with_virustotal`.
        </Note>

    </Step>
    <Step title="Add list comments action">
        Add the **List VirusTotal comments on URL** action to your workflow, then configure the action with the following expression:

        ```yaml
        url: ${{ ACTIONS.extract_virustotal_report.result.url }}
        ```

        ![Add list comments action](/img/tutorials/control-flow/list-vt-comments.png)
    </Step>
    <Step title="Define an if-condition on list comments">
        Let's add a condition to only list comments if the URL has been flagged as malicious more than 10 times.

        You can do this by adding a **Run If** condition to the **List VirusTotal comments on URL** action:

        ```yaml
        ${{ ACTIONS.extract_virustotal_report.result.stats.malicious > 10 }}
        ```

        ![List comments](/img/tutorials/control-flow/list-vt-comments-run-if.png)
    </Step>
    <Step title="Add a loop to iterate over the comments">
        Maybe we want to create a list of comments prefixed by the submitter's name,
        we can do this by adding a **Reshape** action and using a loop to iterate over the comments.
    </Step>
    <Step title="Done!">
        ðŸŽ‰ You've completed the tutorial on control flow in Tracecat!
        Every action in Tracecat can be configured with a **Run If** condition and **Loop Iteration**.
        Use these features to control when an action is run and to manipulate lists of data.
    </Step>
</Steps>

## Next Steps

Check out the [next tutorial on Actions Registry](/tutorials/actions-registry) to learn how to use, edit, and maintain integrations in your workflows.
