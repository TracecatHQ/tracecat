## AWS ALB with managed services (RDS, ElastiCache, S3)
## Prerequisites: AWS Load Balancer Controller, RDS, ElastiCache, S3 bucket, secrets created

secrets:
  existingSecret: tracecat-secrets

# Explicit public URLs (required for ALB since TLS is terminated at load balancer)
urls:
  publicApp: https://tracecat.example.com
  publicApi: https://tracecat.example.com/api

tracecat:
  auth:
    superadminEmail: admin@example.com
  blobStorage:
    endpoint: ""  # Leave empty for AWS S3
    buckets:
      attachments: my-tracecat-attachments
      registry: my-tracecat-registry

ingress:
  enabled: true
  className: alb
  host: tracecat.example.com
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:123456789:certificate/xxx
    alb.ingress.kubernetes.io/ssl-redirect: "443"
    # Health check settings
    alb.ingress.kubernetes.io/healthcheck-path: /ready
    alb.ingress.kubernetes.io/healthcheck-port: "8000"

# Disable internal subcharts (using AWS managed services)
postgres:
  enabled: false
redis:
  enabled: false
minio:
  enabled: false
temporal:
  enabled: true  # Or false if using Temporal Cloud
  # Temporal persistence on the same RDS instance (assume databases already exist).
  server:
    config:
      persistence:
        defaultStore: default
        visibilityStore: visibility
        numHistoryShards: 1024
        datastores:
          default:
            sql:
              pluginName: postgres12
              databaseName: temporal
              connectAddr: tracecat-db.xxxx.us-east-1.rds.amazonaws.com:5432
              user: tracecat
              existingSecret: tracecat-rds-credentials
              secretKey: password
              createDatabase: false
              manageSchema: true
          visibility:
            sql:
              pluginName: postgres12
              databaseName: temporal_visibility
              connectAddr: tracecat-db.xxxx.us-east-1.rds.amazonaws.com:5432
              user: tracecat
              existingSecret: tracecat-rds-credentials
              secretKey: password
              createDatabase: false
              manageSchema: true

# Configure external services
externalPostgres:
  enabled: true
  host: tracecat-db.xxxx.us-east-1.rds.amazonaws.com
  port: 5432
  database: tracecat
  sslMode: require
  auth:
    existingSecret: tracecat-rds-credentials  # Contains 'username' and 'password'
    # Or use Secrets Manager:
    # secretArn: arn:aws:secretsmanager:us-east-1:123456789:secret:tracecat/rds
    # username: tracecat  # Optional if the ARN secret includes `username`

externalRedis:
  enabled: true
  auth:
    existingSecret: tracecat-redis-credentials  # Contains 'url' (redis://host:port)
    # Or use Secrets Manager:
    # secretArn: arn:aws:secretsmanager:us-east-1:123456789:secret:tracecat/redis

externalS3:
  enabled: true
  endpoint: ""  # Empty for AWS S3, or custom endpoint for S3-compatible
  region: us-east-1
  # Use IRSA/IAM roles for access (no keys required).
  # For access keys instead, set:
  # auth:
  #   existingSecret: tracecat-s3-credentials  # Contains 'accessKeyId' and 'secretAccessKey'

# Optional: External Temporal Cloud
# externalTemporal:
#   enabled: true
#   clusterUrl: your-namespace.tmprl.cloud:7233
#   clusterNamespace: your-namespace
#   clusterQueue: tracecat-task-queue
#   auth:
#     existingSecret: tracecat-temporal-credentials  # Contains 'apiKey'
#     # Or use Secrets Manager:
#     # secretArn: arn:aws:secretsmanager:us-east-1:123456789:secret:tracecat/temporal
