# Core secrets (REQUIRED)
secrets:
  # Name of existing Kubernetes Secret containing:
  # - dbEncryptionKey: URL-safe base64 key for DB encryption
  # - serviceKey: Service-to-service auth key (hex)
  # - signingSecret: Webhook signing secret (hex)
  # - userAuthSecret: Password reset/email verification token secret (hex)
  existingSecret: ""

  # (Optional) Name of existing Kubernetes Secret for OAuth containing:
  # - oauthClientId: Google OAuth client ID
  # - oauthClientSecret: Google OAuth client secret
  oauthSecret: ""

# Backend image configuration
image:
  repository: ghcr.io/tracecathq/tracecat
  pullPolicy: IfNotPresent
  # tag: "" # Defaults to Chart.AppVersion

# Frontend image configuration
uiImage:
  repository: ghcr.io/tracecathq/tracecat-ui
  pullPolicy: IfNotPresent
  # tag: "" # Defaults to Chart.AppVersion

securityContext:
  fsGroup: 1001
  runAsUser: 1001

ingress:
  enabled: true
  className: ""
  annotations: {}
  host: tracecat.example.com
  tls: []

urls:
  publicApp: ""
  publicApi: ""
  # Only used to rewrite presigned URLs (defaults to /s3 when minio is enabled).
  publicS3: ""

tracecat:
  appEnv: production
  logLevel: ""
  allowOrigins: ""
  sentryDsn: ""

  sandbox:
    disableNsjail: false

  blobStorage:
    # Optional override for S3-compatible endpoints (leave empty for AWS S3).
    endpoint: ""
    buckets:
      # Defaults to tracecat-attachments if unset.
      attachments: ""
      # Defaults to tracecat-registry if unset.
      registry: ""

  saml:
    enabled: false
    idpMetadataUrl: ""
    allowUnsolicited: "false"
    acceptedTimeDiff: ""
    authnRequestsSigned: "false"
    signedAssertions: "true"
    signedResponses: "true"
    verifySslEntity: "true"
    verifySslMetadata: "true"
    caCerts: ""
    metadataCert: ""

  auth:
    types: "basic,saml"
    allowedDomains: ""
    superadminEmail: ""

enterprise:
  # Modifying the following flags requires a Tracecat Enterprise License.
  # Features activated by feature flags may be gated behind a license key in the future.
  featureFlags: ""

ui:
  replicas: 1
  resources:
    requests:
      cpu: "1000m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "2Gi"

api:
  replicas: 2
  resources:
    requests:
      cpu: "1000m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "2Gi"

worker:
  replicas: 4
  resources:
    requests:
      cpu: "1000m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "2Gi"
  contextCompression:
    enabled: false
    thresholdKb: 16

executor:
  replicas: 2
  resources:
    requests:
      cpu: "1000m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "2Gi"
  queue: "shared-action-queue"
  workerPoolSize: ""
  contextCompression:
    enabled: false
    thresholdKb: 16

# CloudNativePG cluster subchart configuration (aliased as postgres)
postgres:
  enabled: true
  fullnameOverride: tracecat-postgres
  cluster:
    instances: 1

# Valkey subchart configuration (aliased as redis)
redis:
  enabled: true
  fullnameOverride: tracecat-valkey
  dataStorage:
    enabled: true
    size: 5Gi

minio:
  enabled: true
  fullnameOverride: tracecat-minio
  mode: standalone
  primary:
    enabled: true
  auth:
    existingSecret: null

temporal:
  enabled: true
  server:
    config:
      persistence:
        numHistoryShards: 1024
        datastores:
          default:
            sql:
              pluginName: postgres12
              driverName: postgres12
              databaseName: temporal
              connectAddr: ""
              user: ""
              existingSecret: ""
          visibility:
            sql:
              pluginName: postgres12
              driverName: postgres12
              databaseName: temporal_visibility
              connectAddr: ""
              user: ""
              existingSecret: ""
    namespaces:
      create: true
      namespace:
        - name: default
          retention: 720h

externalPostgres:
  enabled: false
  host: "example-db.example.com"
  port: 5432
  database: tracecat
  sslMode: "prefer"
  auth:
    # Either set a Kubernetes secret or an AWS Secrets Manager ARN.
    existingSecret: null  # Contains `username` and `password`.
    # Username to use with secretArn (if omitted, the ARN secret must include `username`).
    username: ""
    # SecretString should be JSON with `password` (and optional `username`) or a raw password when username is set.
    secretArn: null

externalRedis:
  enabled: false
  auth:
    # Either set a Kubernetes secret or an AWS Secrets Manager ARN.
    existingSecret: null  # Contains `url` (raw string)
    # SecretString should be the raw Redis URL.
    secretArn: null

externalS3:
  enabled: false
  endpoint: ""
  region: ""
  auth:
    existingSecret: null  # Contains `accessKeyId` and `secretAccessKey` (optional for IRSA/IAM roles).

externalTemporal:
  enabled: false
  clusterUrl: ""
  clusterQueue: ""
  clusterNamespace: ""
  auth:
    existingSecret: null  # Contains `apiKey` (raw string)
    # SecretString should be the raw API key.
    secretArn: null
