[containers]
# No default capabilities
default_capabilities = []
default_sysctls = []
# Secure volume mounts by default
default_mount_options = ["nodev", "nosuid", "noexec"]
# Prevent privilege escalation
no_new_privileges = true

# Resource limits
pids_limit = 100
memory_limit = "512m"
memory_swap = "512m"
cpu_period = 100000
cpu_quota = 50000  # 50% CPU limit

# Security Labels - Enable SELinux
selinux_enabled = true
# Label containers with a dedicated type
label = "system_u:system_r:container_t:s0:c1,c2"
# Share labels when appropriate
label_opts = ["disable=false"]
# apparmor_enabled = true

[engine]
runtime = "crun"
# Enable rootless mode
userns_mode = "auto"
cgroup_manager = "cgroupfs"
# Enable automatic volume cleanup
volume_cleanup = "true"
# Set events logger
events_logger = "file"
# Set network backend
network_backend = "netavark"

# Timeout settings
stop_timeout = 30
http_timeout = 300

# Add runtime verification
runtime_supports_json = ["crun"]
runtime_supports_nocgroups = ["crun"]
runtime_supports_kvm = ["kata"]

[engine.runtimes]
crun = [
  "/usr/bin/crun",
]

[network]
# Configure network settings for rootless mode
network_backend = "netavark"

# Network isolation defaults - these create more isolated network behavior
default_subnet_pools = [
  {"base" = "10.89.0.0/16", "size" = 24},
  {"base" = "10.90.0.0/15", "size" = 24}
]

# DNS configuration (using reliable public DNS)
dns_servers = ["1.1.1.1", "8.8.8.8"]

# Netavark specific security settings
network_config_dir = "/etc/containers/networks"
default_network = "podman"

# Default to creating an internal network only
default_network_options = {
  "podman" = {
    "isolate" = true,
    "no_dns" = false
  }
}
