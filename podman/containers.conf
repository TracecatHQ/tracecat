[containers]
# No default capabilities - security through minimal privilege
default_capabilities = []
default_sysctls = []

# Secure volume mounts by default
# nodev: prevent device file creation
# nosuid: ignore setuid bits
# noexec: prevent executable files
default_mount_options = ["nodev", "nosuid", "noexec"]

# Prevent privilege escalation - processes cannot gain more privileges
no_new_privileges = true

# === SELinux Configuration for Inner Containers ===
# Enable container separation using SELinux labeling
label = true

# SELinux process context
process_label = "system_u:system_r:container_t:s0"
mount_label = "system_u:object_r:container_file_t:s0"

# Define the range of categories that can be assigned
# This allows Podman to assign unique pairs from c0 to c1023
label_range = "c0,c1023"

# Control label inheritance and sharing
label_opts = ["disable=false"]

[engine]
runtime = "crun"
# Enable SELinux for container engine
selinux_enabled = true
# Enable user namespace remapping for rootless containers
userns_mode = "auto"
cgroup_manager = "cgroupfs"
volume_cleanup = "true"  # Clean up volumes to prevent data leaks
events_logger = "file"
network_backend = "netavark"  # Use netavark for network isolation

# Default seccomp profile path
seccomp_profile = "/etc/containers/seccomp.json"

# Timeout settings
stop_timeout = 30
http_timeout = 300

# Runtime verification
runtime_supports_json = ["crun"]
runtime_supports_nocgroups = ["crun"]
runtime_supports_kvm = ["kata"]

[engine.runtimes]
crun = [
  "/usr/bin/crun",
]

[network]
# Configure network isolation
network_backend = "netavark"

# Network subnets for container isolation
default_subnet_pools = [
  {"base" = "10.89.0.0/16", "size" = 24},
  {"base" = "10.90.0.0/15", "size" = 24}
]

# Trusted DNS providers (Cloudflare, Google)
dns_servers = ["1.1.1.1", "8.8.8.8"]

# Network configuration path
network_config_dir = "/etc/containers/networks"
default_network = "podman"

# === Network Isolation Settings ===
# Prevent container-to-container communication
# Allow DNS resolution
[network.default_network_options.podman]
isolate = true
no_dns = false
